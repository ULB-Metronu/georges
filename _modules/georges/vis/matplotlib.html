

<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>georges.vis.matplotlib &mdash; Georges 2018.2-beta documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Georges
          

          
          </a>

          
            
            
              <div class="version">
                2018.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Georges README</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Georges</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authorship and citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Using and executing Georges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">georges-src</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Georges</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>georges.vis.matplotlib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for georges.vis.matplotlib</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Matplotlib plotting module for Manzoni.</span>

<span class="sd">TODO</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">eig</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">_pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">NullFormatter</span>

<span class="kn">from</span> <span class="nn">lmfit.models</span> <span class="kn">import</span> <span class="n">GaussianModel</span>

<span class="kn">from</span> <span class="nn">georges_core.vis</span> <span class="kn">import</span> <span class="n">MatplotlibArtist</span> <span class="k">as</span> <span class="n">_MatplotlibArtist</span>

<span class="n">PALETTE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;solarized&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;base03&#39;</span><span class="p">:</span> <span class="s1">&#39;#002b36&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base02&#39;</span><span class="p">:</span> <span class="s1">&#39;#073642&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base01&#39;</span><span class="p">:</span> <span class="s1">&#39;#586e75&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base00&#39;</span><span class="p">:</span> <span class="s1">&#39;#657b83&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base0&#39;</span><span class="p">:</span> <span class="s1">&#39;#839496&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base1&#39;</span><span class="p">:</span> <span class="s1">&#39;#93a1a1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base2&#39;</span><span class="p">:</span> <span class="s1">&#39;#eee8d5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;base3&#39;</span><span class="p">:</span> <span class="s1">&#39;#fdf6e3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yellow&#39;</span><span class="p">:</span> <span class="s1">&#39;#b58900&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="s1">&#39;#cb4b16&#39;</span><span class="p">,</span>
        <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;#dc322f&#39;</span><span class="p">,</span>
        <span class="s1">&#39;magenta&#39;</span><span class="p">:</span> <span class="s1">&#39;#d33682&#39;</span><span class="p">,</span>
        <span class="s1">&#39;violet&#39;</span><span class="p">:</span> <span class="s1">&#39;#6c71c4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;#268bd2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cyan&#39;</span><span class="p">:</span> <span class="s1">&#39;#2aa198&#39;</span><span class="p">,</span>
        <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="s1">&#39;#859900&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Define default color palette</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">PALETTE</span><span class="p">[</span><span class="s1">&#39;solarized&#39;</span><span class="p">]</span>

<span class="c1"># Define &quot;logical&quot; colors</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;bend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;coll&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;X_MADX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;Y_MADX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;X_G4BL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;Y_G4BL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;quadrupole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;sextupole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;octupole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span>
<span class="n">palette</span><span class="p">[</span><span class="s1">&#39;multipole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span>

<span class="c1"># Variables required for the old aperture.py</span>
<span class="n">STYLE_BEND_HATCH</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
<span class="n">STYLE_QUAD_HATCH</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


<div class="viewcode-block" id="ManzoniMatplotlibArtist"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist">[docs]</a><span class="k">class</span> <span class="nc">ManzoniMatplotlibArtist</span><span class="p">(</span><span class="n">_MatplotlibArtist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A matplotlib implementation of a `ZgoubiPlot` artist.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">with_boxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">with_centers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">tracks_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            param ax: the matplotlib ax used for plotting. If None it will be created with `init_plot` (kwargs are</span>
<span class="sd">            forwarded).</span>
<span class="sd">            with_boxes: draw the body of each elements</span>
<span class="sd">            with_frames: draw the entry and exit frames of each elements</span>
<span class="sd">            with_centers: draw the center of each polar coordinate elements</span>
<span class="sd">            tracks_color: color for the plotting of tracks</span>
<span class="sd">            kwargs: forwarded to `ZgoubiPlot` and to `init_plot`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">with_boxes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_with_centers</span> <span class="o">=</span> <span class="n">with_centers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tracks_color</span> <span class="o">=</span> <span class="n">tracks_color</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tracks_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The color for the rendering of the tracks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            color as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tracks_color</span>

    <span class="nd">@tracks_color</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tracks_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tracks_color</span> <span class="o">=</span> <span class="n">color</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current Matplotlib ax.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the Matplotlib ax.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ax2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current Matplotlib figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the Matplotlib figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span>

    <span class="nd">@ax</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">ax</span>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.init_plot"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.init_plot">[docs]</a>    <span class="k">def</span> <span class="nf">init_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="mi">111</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Matplotlib figure and ax.</span>

<span class="sd">        Args:</span>
<span class="sd">            subplots: number of subplots</span>
<span class="sd">            figsize: figure size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">subplots</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.plot"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Proxy for matplotlib.pyplot.plot</span>

<span class="sd">        Same as `matplotlib.pyplot.plot`, forwards all arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD common.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.style_boxplot"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.style_boxplot">[docs]</a>    <span class="k">def</span> <span class="nf">style_boxplot</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply fancy styles to a matplotlib boxplot.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bp</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">]:</span>
            <span class="n">box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">bp</span><span class="p">[</span><span class="s1">&#39;whiskers&#39;</span><span class="p">]:</span>
            <span class="n">whisker</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cap</span> <span class="ow">in</span> <span class="n">bp</span><span class="p">[</span><span class="s1">&#39;caps&#39;</span><span class="p">]:</span>
            <span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">median</span> <span class="ow">in</span> <span class="n">bp</span><span class="p">[</span><span class="s1">&#39;medians&#39;</span><span class="p">]:</span>
            <span class="n">median</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">flier</span> <span class="ow">in</span> <span class="n">bp</span><span class="p">[</span><span class="s1">&#39;fliers&#39;</span><span class="p">]:</span>
            <span class="n">flier</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.beamline_get_ticks_locations"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.beamline_get_ticks_locations">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">beamline_get_ticks_locations</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT_CENTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.beamline_get_ticks_labels"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.beamline_get_ticks_labels">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">beamline_get_ticks_labels</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_beamline"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_beamline">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_beamline</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">):</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mf">1.15</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE==&#39;sbend&#39; or TYPE==&#39;rbend&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;K1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">focusing</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;K1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">focusing</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">focusing</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="n">focusing</span> <span class="o">*</span> <span class="mf">0.02</span><span class="p">),</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                    <span class="mf">.1</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE==&#39;sextupole&#39; or TYPE==&#39;quadrupole&#39; or TYPE==&#39;multipole&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">),</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                    <span class="mf">.1</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]],</span>
                    <span class="n">ec</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]],</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE==&#39;rcol&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">),</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                    <span class="mf">.1</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
                    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE==&#39;degrader&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">),</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                    <span class="mf">.1</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS==&#39;CircularCollimator&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">),</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                    <span class="mf">.1</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.prepare"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">bl_short</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">bl_short</span> <span class="o">=</span> <span class="n">bl_short</span><span class="p">[[</span><span class="ow">not</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bl_short</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;DRIFT&quot;</span><span class="p">)]]</span>
        <span class="n">bl_short</span> <span class="o">=</span> <span class="n">bl_short</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>

        <span class="n">ticks_locations_short</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamline_get_ticks_locations</span><span class="p">(</span><span class="n">bl_short</span><span class="p">)</span>
        <span class="n">ticks_labels_short</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamline_get_ticks_labels</span><span class="p">(</span><span class="n">bl_short</span><span class="p">)</span>
        <span class="n">ticks_locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamline_get_ticks_locations</span><span class="p">(</span><span class="n">bl</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">ticks_locations_short</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ticks_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;s (m)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Beam size (mm)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;print_label&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ticks_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">ticks_labels_short</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">ticks_locations_short</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size_arrows&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.103</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.103</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.103</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.103</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.126</span><span class="p">,</span> <span class="mf">0.86</span><span class="p">,</span> <span class="s2">&quot;Vertical&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.126</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="s2">&quot;Horizontal&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;with_beamline&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_beamline</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.filled_plot"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.filled_plot">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD statistics.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.StatisticException"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.StatisticException">[docs]</a>    <span class="k">class</span> <span class="nc">StatisticException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exception raised for errors in the beam plotting module.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">m</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.histogram_fit"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.histogram_fit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">histogram_fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bounds_binning</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">GaussianModel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; All models are available on https://lmfit.github.io/lmfit-py/builtin_models.html#lmfit.models&quot;&quot;&quot;</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bounds_binning</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sigma</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">result</span></div>

    <span class="c1"># THIS IS THE OLD beam.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.BeamPlottingException"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.BeamPlottingException">[docs]</a>    <span class="k">class</span> <span class="nc">BeamPlottingException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exception raised for errors in the beam plotting module.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">m</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.ellipse"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.ellipse">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ellipse</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an ellipse from beam parameters.</span>
<span class="sd">        :param ra: semi-major axis</span>
<span class="sd">        :param rb: semi-minor axis</span>
<span class="sd">        :param angle: oritentation angle</span>
<span class="sd">        :param x0: center X coordinate</span>
<span class="sd">        :param y0: center Y coordinate</span>
<span class="sd">        :return: `matplotlib.patches.Ellipse` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">ra</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">rb</span>
        <span class="k">return</span> <span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                               <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                               <span class="n">fill</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                               <span class="n">linestyle</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">),</span>
                               <span class="n">edgecolor</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">),</span>
                               <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.rotation_angle"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.rotation_angle">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rotation_angle</span><span class="p">(</span><span class="nb">eval</span><span class="p">,</span> <span class="n">evec</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">eval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">evec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">eval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">evec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">evec</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">evec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">evec</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">evec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.phase_space"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.phase_space">[docs]</a>    <span class="k">def</span> <span class="nf">phase_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># SOURCE at</span>
        <span class="c1"># http://www.visiondummy.com/2014/04/draw-error-ellipse-representing-covariance-matrix/</span>
        <span class="c1"># Define the x and y data</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">unit_col_0</span> <span class="o">=</span> <span class="s1">&#39;[mm]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_col_0</span> <span class="o">=</span> <span class="s1">&#39;[mrad]&#39;</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">unit_col_1</span> <span class="o">=</span> <span class="s1">&#39;[mm]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_col_1</span> <span class="o">=</span> <span class="s1">&#39;[mrad]&#39;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">X_mean</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Y_mean</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_mean</span> <span class="o">-</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">X_mean</span> <span class="o">+</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_mean</span> <span class="o">-</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">Y_mean</span> <span class="o">+</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>

        <span class="n">CV</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">[</span><span class="n">Eval</span><span class="p">,</span> <span class="n">Evec</span><span class="p">]</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">CV</span><span class="p">)</span>
        <span class="n">chisq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.278868566</span><span class="p">,</span> <span class="mf">5.991464547</span><span class="p">,</span> <span class="mf">11.61828598</span><span class="p">]</span>
        <span class="n">X_r</span><span class="p">,</span> <span class="n">Y_r</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chisq</span><span class="p">)):</span>
            <span class="n">X_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">chisq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Eval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">Y_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">chisq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Eval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Define the locations for the axes</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.6</span>
        <span class="n">bottom</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.6</span>
        <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">left_h</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="mf">0.05</span>
        <span class="c1"># Set up the geometry of the three plots</span>
        <span class="n">rect_beam</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of temp plot</span>
        <span class="n">rect_histx</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>  <span class="c1"># dimensions of x-histogram</span>
        <span class="n">rect_histy</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of y-histogram</span>
        <span class="n">rect_tab</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>  <span class="c1"># dimensions of tab</span>
        <span class="c1"># Make the three plots</span>
        <span class="n">ax_global</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam</span><span class="p">)</span>  <span class="c1"># beam plot</span>
        <span class="n">ax_histx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histx</span><span class="p">)</span>  <span class="c1"># x histogram</span>
        <span class="n">ax_histy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histy</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Remove the inner axes numbers of the histograms</span>
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="c1"># Find the min/max of the data</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
        <span class="c1"># Make the &#39;main&#39; beam plot</span>
        <span class="c1"># Define the number of bins</span>
        <span class="n">nxbins</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">nybins</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">xbins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nxbins</span><span class="p">)</span>
        <span class="n">ybins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nybins</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">ybins</span><span class="p">,</span> <span class="n">xbins</span><span class="p">))</span>
        <span class="c1"># Plot the beam data</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax_global</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span>
                              <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                              <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;gist_gray_r&#39;</span><span class="p">)))</span>
        <span class="c1"># Plot the beam plot contours</span>
        <span class="n">contourcolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

        <span class="n">ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">(</span><span class="n">Eval</span><span class="p">,</span> <span class="n">Evec</span><span class="p">)</span>
        <span class="n">ang_annotx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
        <span class="n">ang_annoty</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw_ellipse&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">))</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">))</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">))</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$1</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                               <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">contourcolor</span><span class="p">)</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$2</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                               <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">contourcolor</span><span class="p">)</span>
            <span class="n">ax_global</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$3</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annotx</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ang_annoty</span><span class="p">),</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                               <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">contourcolor</span><span class="p">)</span>
        <span class="c1"># Plot the axes labels</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit_col_0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit_col_1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="c1"># Set up the histogram bins</span>
        <span class="n">xbins</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nxbins</span><span class="p">)</span>
        <span class="n">ybins</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nybins</span><span class="p">)</span>
        <span class="c1"># Plot the histograms</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">binsx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_histx</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">xbins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">binsy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_histy</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">ybins</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="c1"># Set up the histogram limits</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gaussian_fit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">limx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nxbins</span><span class="p">)</span>
            <span class="n">bin_centerx</span><span class="p">,</span> <span class="n">fitresults_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">histogram_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bounds_binning</span><span class="o">=</span><span class="n">limx</span><span class="p">,</span>
                                                           <span class="n">verbose</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="n">ax_histx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centerx</span><span class="p">,</span> <span class="n">fitresults_x</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">limy</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nybins</span><span class="p">)</span>
            <span class="n">bin_centery</span><span class="p">,</span> <span class="n">fitresults_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">histogram_fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bounds_binning</span><span class="o">=</span><span class="n">limy</span><span class="p">,</span>
                                                           <span class="n">verbose</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="n">ax_histy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fitresults_y</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="n">bin_centery</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw_tab&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">mean_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">std_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">median_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">mean_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">std_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">median_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>

            <span class="n">ax_tab</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_tab</span><span class="p">)</span>  <span class="c1"># y histogram</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">ax_tab</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">ax_tab</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.83</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;std &#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

            <span class="n">xname</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">unit_col_0</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">unit_col_1</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">mean_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">std_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">median_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">mean_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">std_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">median_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.phase_space_d"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.phase_space_d">[docs]</a>    <span class="k">def</span> <span class="nf">phase_space_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax_global</span><span class="p">,</span> <span class="n">ax_histx</span><span class="p">,</span> <span class="n">ax_histy</span><span class="p">,</span> <span class="n">ax_tab</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">elt</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="c1"># SOURCE at</span>
        <span class="c1"># http://www.visiondummy.com/2014/04/draw-error-ellipse-representing-covariance-matrix/</span>
        <span class="c1"># Define the x and y data</span>

        <span class="k">if</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="ow">or</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">unit_col_0</span> <span class="o">=</span> <span class="s1">&#39;[mm]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_col_0</span> <span class="o">=</span> <span class="s1">&#39;[mrad]&#39;</span>
        <span class="k">if</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="ow">or</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">unit_col_1</span> <span class="o">=</span> <span class="s1">&#39;[mm]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_col_1</span> <span class="o">=</span> <span class="s1">&#39;[mrad]&#39;</span>

        <span class="n">dico_plane</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">elt</span><span class="p">][:,</span> <span class="n">dico_plane</span><span class="p">[</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">elt</span><span class="p">][:,</span> <span class="n">dico_plane</span><span class="p">[</span><span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>

        <span class="n">X_mean</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Y_mean</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_mean</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">X_mean</span> <span class="o">+</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_mean</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">Y_mean</span> <span class="o">+</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>

        <span class="n">CV</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">[</span><span class="n">Eval</span><span class="p">,</span> <span class="n">Evec</span><span class="p">]</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">CV</span><span class="p">)</span>
        <span class="n">chisq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.278868566</span><span class="p">,</span> <span class="mf">5.991464547</span><span class="p">,</span> <span class="mf">11.61828598</span><span class="p">]</span>
        <span class="n">X_r</span><span class="p">,</span> <span class="n">Y_r</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chisq</span><span class="p">)):</span>
            <span class="n">X_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">chisq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Eval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">Y_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">chisq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Eval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Find the min/max of the data</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xlims</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xlims</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ylims</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>

        <span class="c1"># Make the &#39;main&#39; beam plot</span>
        <span class="c1"># Define the number of bins</span>
        <span class="n">nxbins</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">nybins</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">xbins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nxbins</span><span class="p">)</span>
        <span class="n">ybins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nybins</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">ybins</span><span class="p">,</span> <span class="n">xbins</span><span class="p">))</span>
        <span class="c1"># Plot the beam data</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax_global</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span>
                              <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                              <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_gray_r&#39;</span><span class="p">))</span>
        <span class="c1"># Plot the beam plot contours</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">(</span><span class="n">Eval</span><span class="p">,</span> <span class="n">Evec</span><span class="p">)</span>
        <span class="n">ang_annotx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">));</span>
        <span class="n">ang_annoty</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$1</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">))</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$2</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">))</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">X_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Y_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">X_mean</span><span class="p">,</span> <span class="n">Y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$3</span><span class="se">\\</span><span class="s1">sigma$&#39;</span><span class="p">))</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="c1"># Plot the axes labels</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit_col_0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit_col_1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="c1"># Set up the histogram bins</span>
        <span class="n">xbins</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nxbins</span><span class="p">)</span>
        <span class="n">ybins</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nybins</span><span class="p">)</span>
        <span class="c1"># Plot the histograms</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">binsx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_histx</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">xbins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">binsy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_histy</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">ybins</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="c1"># Set up the histogram limits</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">ax_global</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>

        <span class="n">limx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nxbins</span><span class="p">)</span>
        <span class="n">bin_centerx</span><span class="p">,</span> <span class="n">fitresults_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">histogram_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bounds_binning</span><span class="o">=</span><span class="n">limx</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centerx</span><span class="p">,</span> <span class="n">fitresults_x</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">limy</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nybins</span><span class="p">)</span>
        <span class="n">bin_centery</span><span class="p">,</span> <span class="n">fitresults_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">histogram_fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bounds_binning</span><span class="o">=</span><span class="n">limy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fitresults_y</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="n">bin_centery</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mean_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">std_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">median_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">mean_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">std_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">median_y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">ax_tab</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">ax_tab</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">ax_tab</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mf">0.83</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;std &#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">unit_col_0</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">unit_col_1</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">mean_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">std_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">median_x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">mean_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">std_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">median_y</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.five_spot_map"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.five_spot_map">[docs]</a>    <span class="k">def</span> <span class="nf">five_spot_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl_track0</span><span class="p">,</span> <span class="n">bl_track1</span><span class="p">,</span> <span class="n">bl_track2</span><span class="p">,</span> <span class="n">bl_track3</span><span class="p">,</span> <span class="n">bl_track4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Order the 5 simulations outputs</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">blcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">brcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">tlcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">trcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">datax</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">center</span><span class="p">,</span> <span class="n">blcorner</span><span class="p">,</span> <span class="n">brcorner</span><span class="p">,</span> <span class="n">tlcorner</span><span class="p">,</span> <span class="n">trcorner</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">center</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
            <span class="n">blcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
            <span class="n">brcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
            <span class="n">tlcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
            <span class="n">trcorner</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
            <span class="n">datay</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">center</span><span class="p">,</span> <span class="n">blcorner</span><span class="p">,</span> <span class="n">brcorner</span><span class="p">,</span> <span class="n">tlcorner</span><span class="p">,</span> <span class="n">trcorner</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error, one simulation is missing. You have to put the 5 simulations outputs in the functions&#39;</span><span class="p">)</span>

        <span class="c1"># Create the 2D histogram with the 5 spots.</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">datax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">datay</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_gray_r&#39;</span><span class="p">)</span>
        <span class="n">data_X</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">data_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">data_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">data_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">data_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>

        <span class="n">data_S</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span>
        <span class="n">data_S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span>
        <span class="n">data_S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span>
        <span class="n">data_S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span>
        <span class="n">data_S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span>

        <span class="n">data_T</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_angle_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                                                           <span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track0</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span>
                                                               <span class="s1">&#39;Y&#39;</span><span class="p">]))))</span>
        <span class="n">data_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_angle_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                                                           <span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track1</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span>
                                                               <span class="s1">&#39;Y&#39;</span><span class="p">]))))</span>
        <span class="n">data_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_angle_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                                                           <span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track2</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span>
                                                               <span class="s1">&#39;Y&#39;</span><span class="p">]))))</span>
        <span class="n">data_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_angle_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                                                           <span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track3</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span>
                                                               <span class="s1">&#39;Y&#39;</span><span class="p">]))))</span>
        <span class="n">data_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_angle_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                                                           <span class="mf">1e3</span> <span class="o">*</span> <span class="n">bl_track4</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;BEAM&#39;</span><span class="p">][</span><span class="s1">&#39;ISO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span>
                                                               <span class="s1">&#39;Y&#39;</span><span class="p">]))))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\sigma_X = </span><span class="si">{}</span><span class="s1">$mm </span><span class="se">\n</span><span class="s1"> $S = </span><span class="si">{}</span><span class="s1">$% </span><span class="se">\n</span><span class="s1"> $\phi=</span><span class="si">{}</span><span class="s1"> °$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data_X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                                                                            <span class="nb">round</span><span class="p">(</span><span class="n">data_T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                     <span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\sigma_X = </span><span class="si">{}</span><span class="s1">$mm </span><span class="se">\n</span><span class="s1"> $S = </span><span class="si">{}</span><span class="s1">$% </span><span class="se">\n</span><span class="s1"> $\phi=</span><span class="si">{}</span><span class="s1"> °$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data_X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_S</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                                                                            <span class="nb">round</span><span class="p">(</span><span class="n">data_T</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                     <span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\sigma_X = </span><span class="si">{}</span><span class="s1">$mm </span><span class="se">\n</span><span class="s1"> $S = </span><span class="si">{}</span><span class="s1">$% </span><span class="se">\n</span><span class="s1"> $\phi=</span><span class="si">{}</span><span class="s1"> °$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data_X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_S</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                                                                            <span class="nb">round</span><span class="p">(</span><span class="n">data_T</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                     <span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\sigma_X = </span><span class="si">{}</span><span class="s1">$mm </span><span class="se">\n</span><span class="s1"> $S = </span><span class="si">{}</span><span class="s1">$% </span><span class="se">\n</span><span class="s1"> $\phi=</span><span class="si">{}</span><span class="s1"> °$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data_X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_S</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                                                                            <span class="nb">round</span><span class="p">(</span><span class="n">data_T</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                     <span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\sigma_X = </span><span class="si">{}</span><span class="s1">$mm </span><span class="se">\n</span><span class="s1"> $S = </span><span class="si">{}</span><span class="s1">$% </span><span class="se">\n</span><span class="s1"> $\phi=</span><span class="si">{}</span><span class="s1"> °$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data_X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                                                                            <span class="nb">round</span><span class="p">(</span><span class="n">data_T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                     <span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.halo"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.halo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">halo</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Return a dataframe containing the 1st, 5th, 95th and 99th percentiles of each dimensions.&quot;&quot;&quot;</span>

        <span class="n">halo</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.842701</span><span class="p">),</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.842701</span><span class="p">),</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.95</span><span class="p">),</span>
            <span class="n">distribution</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mf">0.01</span><span class="p">:</span> <span class="s1">&#39;1%&#39;</span><span class="p">,</span>
                                   <span class="mf">0.05</span><span class="p">:</span> <span class="s1">&#39;5%&#39;</span><span class="p">,</span>
                                   <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.842701</span><span class="p">:</span> <span class="s1">&#39;20%&#39;</span><span class="p">,</span>
                                   <span class="mf">0.842701</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span>
                                   <span class="mf">0.95</span><span class="p">:</span> <span class="s1">&#39;95%&#39;</span><span class="p">,</span>
                                   <span class="mf">0.99</span><span class="p">:</span> <span class="s1">&#39;99%&#39;</span>
                                   <span class="p">}</span>
                          <span class="p">)</span>
        <span class="k">return</span> <span class="n">halo</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.compute_halo"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.compute_halo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Return a dataframe containing the 1st, 5th, 95th and 99th percentiles of each dimensions.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="n">halo</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">percentile</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">halo</span></div>

    <span class="c1"># THIS IS THE OLD aperture.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.xy_from_string"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.xy_from_string">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xy_from_string</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">converted</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">convert</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">convert</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_chamber"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_chamber">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_chamber</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_UP&#39;</span><span class="p">])),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">],</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;base01&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_DOWN&#39;</span><span class="p">])),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">],</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;base01&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_quad"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_quad">[docs]</a>    <span class="k">def</span> <span class="nf">draw_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_UP&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">]),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="n">STYLE_QUAD_HATCH</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_DOWN&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">]),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="o">-</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="n">STYLE_QUAD_HATCH</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_chamber</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_coll"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_coll">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_coll</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">plane</span><span class="p">):</span>
        <span class="c1"># if &#39;PIPE&#39; not in e:</span>
        <span class="c1">#    return</span>
        <span class="c1"># if not _np.isnan(e[&#39;PIPE&#39;]):</span>
        <span class="c1">#    return</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_UP&#39;</span><span class="p">]),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;coll&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_DOWN&#39;</span><span class="p">]),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="o">-</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;coll&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_bend"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_bend">[docs]</a>    <span class="k">def</span> <span class="nf">draw_bend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_UP&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">tmp</span> <span class="o">&lt;</span> <span class="mi">55</span> <span class="k">else</span> <span class="mi">55</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="n">STYLE_BEND_HATCH</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;bend&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;APERTURE_DOWN&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="n">tmp</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">55</span> <span class="k">else</span> <span class="o">-</span><span class="mi">55</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="o">-</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="n">STYLE_BEND_HATCH</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;bend&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_chamber</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.fill_aperture"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.fill_aperture">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_aperture</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_APERTURE&#39;</span> <span class="ow">in</span> <span class="n">context</span> <span class="ow">and</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SLITS&#39;</span><span class="p">:</span>
            <span class="n">element</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_APERTURE&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COLLIMATOR&#39;</span> <span class="ow">and</span> \
                <span class="n">element</span><span class="p">[</span><span class="s1">&#39;PLUG&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APERTURE&#39;</span> <span class="ow">and</span> \
                <span class="n">element</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]):</span>
            <span class="n">element</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;CIRCUIT&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">element</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.aperture"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.aperture">[docs]</a>    <span class="k">def</span> <span class="nf">aperture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="s1">&#39;APERTURE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bl</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">planes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">planes</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">planes</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;APERTURE_UP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="p">)</span>
        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;APERTURE_DOWN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;CHAMBER&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bl</span><span class="p">:</span>
            <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CHAMBER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CHAMBER_UP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CHAMBER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span>
        <span class="p">)</span>
        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CHAMBER_DOWN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CHAMBER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span>
        <span class="p">)</span>

        <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS == &#39;Quadrupole&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_quad</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS == &#39;SBend&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_bend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS == &#39;RBend&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_bend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS == &#39;RectangularCollimator&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_coll</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">planes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CLASS == &#39;CircularCollimator&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_coll</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">planes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD bpm.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_bpm_size"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_bpm_size">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_bpm_size</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">),</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.bpm"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.bpm">[docs]</a>    <span class="k">def</span> <span class="nf">bpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;plane&#39; argument must be provided.&quot;</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;BPM_STD_</span><span class="si">{</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_bpm_size</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;AT_CENTER&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;BPM_STD_</span><span class="si">{</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD losses.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.losses"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.losses">[docs]</a>    <span class="k">def</span> <span class="nf">losses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the losses from a beamline tracking computation and a context.&quot;&quot;&quot;</span>
        <span class="n">losses_palette</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>
        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">]))</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE == TYPE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;AT_CENTER&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span>
        <span class="n">transmission</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE == TYPE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;AT_CENTER&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">_pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
                <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;AT_EXIT&#39;</span><span class="p">],</span>
                <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init</span>
            <span class="p">}),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">with_beamline</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;with_beamline&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ticks_locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamline_get_ticks_locations</span><span class="p">(</span><span class="n">bl</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;T ($\%$)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]),</span> <span class="mi">100</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ticks_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Losses ($\%$)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="mf">0.125</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
               <span class="n">edgecolor</span><span class="o">=</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">],</span>
               <span class="n">color</span><span class="o">=</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">],</span>
               <span class="n">error_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ecolor</span><span class="o">=</span><span class="n">losses_palette</span><span class="p">[</span><span class="s1">&#39;base02&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">5.0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;with_current&#39;</span><span class="p">):</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;AT_EXIT&#39;</span><span class="p">],</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;CURRENT&#39;</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transmission</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span></div>

    <span class="c1"># THIS IS THE OLD scattering.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_slab"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_slab">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_slab</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">materials_colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;graphite&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
            <span class="s1">&#39;beryllium&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
            <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
            <span class="s1">&#39;lexan&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;LENGTH&#39;</span><span class="p">],</span>  <span class="c1"># width</span>
                <span class="mi">2</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">materials_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;MATERIAL&#39;</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.draw_measuring_plane"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.draw_measuring_plane">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">draw_measuring_plane</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;AT_ENTRY&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.005</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                <span class="mf">0.01</span><span class="p">,</span>  <span class="c1"># width</span>
                <span class="mi">2</span><span class="p">,</span>  <span class="c1"># height</span>
                <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.scattering"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.scattering">[docs]</a>    <span class="k">def</span> <span class="nf">scattering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE == &#39;slab&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_slab</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;TYPE == &#39;mp&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_measuring_plane</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD summary.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.tracking_summary"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.tracking_summary">[docs]</a>    <span class="k">def</span> <span class="nf">tracking_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;`bl` cannot be None.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">size_arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">size_arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">size_arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.summary"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;DRIFT_ISO&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="c1"># Define the left bottom corner block</span>
        <span class="n">space</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">hwidth</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">bottom</span><span class="p">,</span> <span class="n">hheight</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">left_h</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">space</span>
        <span class="c1"># Set up the geometry of the three plots</span>
        <span class="n">rect_beam</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of temp plot</span>
        <span class="n">rect_histx</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of x-histogram</span>
        <span class="n">rect_histy</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of y-histogram</span>
        <span class="n">rect_tab</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of tab</span>
        <span class="c1"># Make the three plots</span>
        <span class="n">ax_global</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam</span><span class="p">)</span>  <span class="c1"># beam plot</span>
        <span class="n">ax_histx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histx</span><span class="p">)</span>  <span class="c1"># x histogram</span>
        <span class="n">ax_histy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histy</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_tab</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_tab</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_space_d</span><span class="p">(</span><span class="n">ax_global</span><span class="p">,</span> <span class="n">ax_histx</span><span class="p">,</span> <span class="n">ax_histy</span><span class="p">,</span> <span class="n">ax_tab</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

        <span class="c1"># Define the right bottom corner block</span>
        <span class="n">x_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">space</span> <span class="o">+</span> <span class="n">hwidth</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">space</span>
        <span class="n">n_left</span> <span class="o">=</span> <span class="n">x_bound</span>
        <span class="n">left_h</span> <span class="o">=</span> <span class="n">n_left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">space</span>
        <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="n">space</span>
        <span class="c1"># Set up the geometry of the three plots</span>
        <span class="n">rect_beam</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of temp plot</span>
        <span class="n">rect_histx</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of x-histogram</span>
        <span class="n">rect_histy</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of y-histogram</span>
        <span class="n">rect_tab</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of tab</span>
        <span class="c1"># Make the three plots</span>
        <span class="n">ax_global</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam</span><span class="p">)</span>  <span class="c1"># beam plot</span>
        <span class="n">ax_histx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histx</span><span class="p">)</span>  <span class="c1"># x histogram</span>
        <span class="n">ax_histy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histy</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_tab</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_tab</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_tab</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_space_d</span><span class="p">(</span><span class="n">ax_global</span><span class="p">,</span> <span class="n">ax_histx</span><span class="p">,</span> <span class="n">ax_histy</span><span class="p">,</span> <span class="n">ax_tab</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

        <span class="c1"># Define the right top corner block</span>
        <span class="n">y_bound</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="n">space</span> <span class="o">+</span> <span class="n">hheight</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">space</span>
        <span class="n">n_bottom</span> <span class="o">=</span> <span class="n">y_bound</span>
        <span class="n">left_h</span> <span class="o">=</span> <span class="n">n_left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">space</span>
        <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">n_bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="n">space</span>
        <span class="c1"># Set up the geometry of the three plots</span>
        <span class="n">rect_beam</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_left</span><span class="p">,</span> <span class="n">n_bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of temp plot</span>
        <span class="n">rect_histx</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of x-histogram</span>
        <span class="n">rect_histy</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">n_bottom</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>  <span class="c1"># dimensions of y-histogram</span>
        <span class="n">rect_tab</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">hwidth</span><span class="p">,</span> <span class="n">hheight</span><span class="p">]</span>  <span class="c1"># dimensions of tab</span>
        <span class="c1"># Make the three plots</span>
        <span class="n">ax_global</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam</span><span class="p">)</span>  <span class="c1"># beam plot</span>
        <span class="n">ax_histx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histx</span><span class="p">)</span>  <span class="c1"># x histogram</span>
        <span class="n">ax_histy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_histy</span><span class="p">)</span>  <span class="c1"># y histogram</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
        <span class="n">ax_histx</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_histy</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">nullfmt</span><span class="p">)</span>
        <span class="n">ax_tab</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_tab</span><span class="p">)</span>  <span class="c1"># y histogram</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_space_d</span><span class="p">(</span><span class="n">ax_global</span><span class="p">,</span> <span class="n">ax_histx</span><span class="p">,</span> <span class="n">ax_histy</span><span class="p">,</span> <span class="n">ax_tab</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

        <span class="c1"># Define the left top corner block</span>
        <span class="n">n_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">space</span> <span class="o">+</span> <span class="n">hheight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="n">n_width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="n">space</span> <span class="o">+</span> <span class="n">hwidth</span>
        <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">n_bottom</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">space</span> <span class="o">+</span> <span class="n">n_height</span> <span class="o">+</span> <span class="n">space</span>
        <span class="n">bottom_hh</span> <span class="o">=</span> <span class="n">bottom_h</span> <span class="o">+</span> <span class="n">n_height</span> <span class="o">+</span> <span class="n">space</span>
        <span class="c1"># Set up the geometry of the three plots</span>
        <span class="n">rect_beam_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom_hh</span><span class="p">,</span> <span class="n">n_width</span><span class="p">,</span> <span class="n">n_height</span><span class="p">]</span>
        <span class="n">rect_beam_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">n_width</span><span class="p">,</span> <span class="n">n_height</span><span class="p">]</span>
        <span class="n">rect_trans</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">n_bottom</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">space</span><span class="p">,</span> <span class="n">n_width</span><span class="p">,</span> <span class="n">n_height</span><span class="p">]</span>
        <span class="c1"># Make the three plots</span>
        <span class="n">ax_beam_x</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam_x</span><span class="p">)</span>  <span class="c1"># beam plot</span>
        <span class="n">ax_beam_y</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_beam_y</span><span class="p">)</span>  <span class="c1"># x histogram</span>
        <span class="n">ax_trans</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect_trans</span><span class="p">)</span>  <span class="c1"># y histogram</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax_beam_x</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span><span class="p">(</span><span class="n">ax_beam_x</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking</span><span class="p">(</span><span class="n">ax_beam_x</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">halo99</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax_beam_y</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">print_label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span><span class="p">(</span><span class="n">ax_beam_y</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking</span><span class="p">(</span><span class="n">ax_beam_y</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">halo99</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ax_trans</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">print_label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">losses_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="p">(</span><span class="n">ax_trans</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax_beam_x</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Horizontal beam size [mm]&quot;</span><span class="p">)</span>
        <span class="n">ax_beam_y</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Vertical beam size [mm]&quot;</span><span class="p">)</span>
        <span class="n">ax_beam_x</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax_beam_y</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax_beam_x</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_beam_y</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_beam_x</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>
        <span class="n">ax_beam_y</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="c1"># THIS SI THE OLD survey.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.survey_iba"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.survey_iba">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">survey_iba</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X (m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y (m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">_pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
                                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span>
                                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">shrinkA</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                                <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span>
                                <span class="p">)</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CLASS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;QUADRUPOLE&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                        <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                            <span class="mf">0.20</span><span class="p">,</span>  <span class="c1"># width</span>
                            <span class="mf">0.20</span><span class="p">,</span>  <span class="c1"># height</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#268bd2&#39;</span><span class="p">,</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#268bd2&#39;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CLASS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RBEND&#39;</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CLASS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SBEND&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                        <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                            <span class="mf">0.250</span><span class="p">,</span>  <span class="c1"># width</span>
                            <span class="mf">0.250</span><span class="p">,</span>  <span class="c1"># height</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#dc322f&#39;</span><span class="p">,</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#dc322f&#39;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                        <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>  <span class="c1"># (x,y)</span>
                            <span class="mf">0.250</span><span class="p">,</span>  <span class="c1"># width</span>
                            <span class="mf">0.250</span><span class="p">,</span>  <span class="c1"># height</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#657b83&#39;</span><span class="p">,</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#657b83&#39;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;datalim&#39;</span><span class="p">)</span></div>

    <span class="n">ELEMENT_COLORS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;QUADRUPOLE&#39;</span><span class="p">:</span> <span class="s1">&#39;#cb4b16&#39;</span><span class="p">,</span>  <span class="c1"># Solarized &#39;orange&#39;</span>
        <span class="s1">&#39;SEXTUPOLE&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OCTUPOLE&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MULTIPOLE&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span>
    <span class="p">}</span>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.survey_madx"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.survey_madx">[docs]</a>    <span class="k">def</span> <span class="nf">survey_madx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">):</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="p">[</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]))),</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="p">[</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()])))</span>
        <span class="p">]</span>
        <span class="n">y_edges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="p">[</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]))),</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="p">[</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()])))</span>
        <span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">x_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">x_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">]</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">])</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SBEND&#39;</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MARKER&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SBEND&#39;</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MAIN_BEND&#39;</span><span class="p">):</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MAIN_BEND&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;b&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MARKER&#39;</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="mf">0.1</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">]</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">180.0</span>
                <span class="n">centre</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">)]</span>
                <span class="n">theta1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">theta2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">theta1</span> <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">theta2</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Wedge</span><span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DRIFT&#39;</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">]),</span>
                        <span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span>
                    <span class="p">),</span>
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span>
                    <span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">angle</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">]),</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;MULTIPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;QUADRUPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;SEXTUPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCTUPOLE&#39;</span><span class="p">):</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">]),</span>
                        <span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">])</span>
                    <span class="p">),</span>
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span>
                    <span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">angle</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;THETA&#39;</span><span class="p">]),</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_COLORS</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]],</span>
                    <span class="n">ec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_COLORS</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]],</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.survey"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.survey">[docs]</a>    <span class="k">def</span> <span class="nf">survey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;madx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;iba_survey&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survey_iba</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;madx&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survey_madx</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Style not supported.&quot;</span><span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD tracking.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.tracking"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.tracking">[docs]</a>    <span class="k">def</span> <span class="nf">tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">beam_o_df</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the beam envelopes from tracking data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plane&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Plane (plane=&#39;X&#39; or plane=&#39;Y&#39;) must be specified.&quot;</span><span class="p">)</span>

        <span class="n">plane</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plane&quot;</span><span class="p">)</span>
        <span class="n">tracking_palette</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The &#39;plane&#39; keyword argument must be set to &#39;X&#39; or &#39;Y&#39;.&quot;</span><span class="p">)</span>
        <span class="n">halo_99</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;halo_99&quot;</span><span class="p">)</span>
        <span class="n">std_bpm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;std_bpm&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">dico_plane</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;PX&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;PY&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">_pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
            <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span>
            <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference_plane&quot;</span><span class="p">,</span> <span class="s1">&#39;AT_EXIT&#39;</span><span class="p">)],</span>
            <span class="s1">&#39;1%&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span> <span class="mf">0.023</span><span class="p">,</span> <span class="n">plane</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span>
                                                                                                  <span class="mf">0.5</span><span class="p">,</span>
                                                                                                  <span class="n">plane</span><span class="p">))</span> <span class="k">if</span> <span class="n">halo_99</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;5%&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span> <span class="mf">0.159</span><span class="p">,</span> <span class="n">plane</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span>
                                                                                                  <span class="mf">0.5</span><span class="p">,</span>
                                                                                                  <span class="n">plane</span><span class="p">))</span> <span class="k">if</span> <span class="n">halo</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;95%&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span> <span class="mf">0.841</span><span class="p">,</span> <span class="n">plane</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span>
                                                                                                  <span class="mf">0.5</span><span class="p">,</span>
                                                                                                  <span class="n">plane</span><span class="p">))</span> <span class="k">if</span> <span class="n">halo</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;99%&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span> <span class="mf">0.977</span><span class="p">,</span> <span class="n">plane</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_halo</span><span class="p">(</span><span class="n">beam_o_df</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span>
                                                                                                  <span class="mf">0.5</span><span class="p">,</span>
                                                                                                  <span class="n">plane</span><span class="p">))</span> <span class="k">if</span> <span class="n">halo_99</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]][:,</span> <span class="n">dico_plane</span><span class="p">[</span><span class="n">plane</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="n">mean</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">beam_o_df</span><span class="p">[</span><span class="s1">&#39;BEAM_OUT&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]][:,</span> <span class="n">dico_plane</span><span class="p">[</span><span class="n">plane</span><span class="p">]]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">if</span> <span class="n">std</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">t</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">halo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;5%&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;95%&#39;</span><span class="p">],</span> <span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;5%&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;95%&#39;</span><span class="p">],</span> <span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">halo_99</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;1%&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;99%&#39;</span><span class="p">],</span> <span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;^-&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;v-&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">std_bpm</span><span class="p">:</span>
            <span class="c1"># Adjustment to avoid plotting zero values where no BPM is present</span>
            <span class="n">t</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">std_bpm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;std_bpm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;std_bpm&#39;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;std_bpm_err&#39;</span><span class="p">],</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">elinewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;std_bpm&#39;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;std_bpm_err&#39;</span><span class="p">],</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">elinewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mean</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;*-&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">tracking_palette</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
                    <span class="p">)</span></div>

    <span class="c1"># THIS IS THE OLD twiss.py</span>
<div class="viewcode-block" id="ManzoniMatplotlibArtist.twiss"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.twiss">[docs]</a>    <span class="k">def</span> <span class="nf">twiss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the Twiss beam envelopes from a beamline Twiss computation and a context.&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">bl</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span>

        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAXMONO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;BETX&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;EMITX&#39;</span><span class="p">])</span>
        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAXMONO&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;DPP&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;DX&#39;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;BETY&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;EMITY&#39;</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAXMONO&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAXMONO&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAXMONO&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;XMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bl</span><span class="p">[</span><span class="s1">&#39;YMAX&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.beta"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.beta">[docs]</a>    <span class="k">def</span> <span class="nf">beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the Twiss beta functions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;BETA&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;BET&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.alpha"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.alpha">[docs]</a>    <span class="k">def</span> <span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the Twiss alpha functions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ALF&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.dispersion"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.dispersion">[docs]</a>    <span class="k">def</span> <span class="nf">dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">planes</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">rel_beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the dispersion functions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;DISP&#39;</span><span class="p">],</span> <span class="n">ptc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">planes</span><span class="o">=</span><span class="n">planes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Caution: MAD-X dispersion is affected by relativistic factors</span>
            <span class="c1"># See section 1.7.4 of the MAD-X user guide</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">rel_beta</span> <span class="o">*</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;DX&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">rel_beta</span> <span class="o">*</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.phase_advance"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.phase_advance">[docs]</a>    <span class="k">def</span> <span class="nf">phase_advance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the phase advance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MU&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="ManzoniMatplotlibArtist.twiss_function_plot"><a class="viewcode-back" href="../../../api/georges.vis.html#georges.vis.matplotlib.ManzoniMatplotlibArtist.twiss_function_plot">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">twiss_function_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">functions</span><span class="p">,</span> <span class="n">planes</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bl</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">line</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">planes</span> <span class="ow">is</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">planes</span> <span class="ow">is</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">bl</span><span class="p">[</span><span class="n">f</span> <span class="o">+</span> <span class="n">x</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">planes</span> <span class="ow">is</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">planes</span> <span class="ow">is</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> <span class="n">bl</span><span class="p">[</span><span class="n">f</span> <span class="o">+</span> <span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017 - 2018, Cédric Hernalsteens, Robin Tesse, Kévin André.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>